@{
    ViewBag.Title = "Index";
}

<div>
    <table id="tabRole"></table>
    <div id="toolbar">
        <a href="###" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="showEdit()">新增角色</a>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        $("#tabRole").datagrid({
            url: '@Url.Action("GetRoleList")',
            title: '角色功能信息',
            singleSelect: true,
            loadMsg: '数据载入中...',
            pagination: true, // 是否显示分页控件
            pagesize: 10,      // 每页行数
            pageList: [10],    // 要选的每页行数 为了界面显示正确一定要和pagesize的值相同
            height: '700px',
            toolbar: '#toolbar',
            columns: [[
                {
                    field: '_operate', title: '操作', width: 150, align: 'center'
                    , formatter: function (value, row, index) {
                        var onclickEvent = 'showEdit(' +row.ID + ');';
                        var html = '<a href="javascript:void(0)"  class="loan_remove_button"'
                                 + 'onclick="removeRole(\'' + row.ID + '\',\'' + row.RoleName + '\')" >删除</a>'
                                 + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
                                 + '<a href="javascript:void(0)"  class="loan_edit_button" '
                                 + ' onclick="' + onclickEvent + '" >修改</a>';
                        console.log(html);
                        return html;
                    }
                },
                { field: 'ID', title: 'ID', width: 100, align: 'center' },
                { field: 'RoleName', title: '角色名称', width: 100, align: 'center' },
                {
                    field: 'CreateDate', title: '创建日期', width: 150, align: 'center'
                    , formatter: dateTimeFormatter
                },
                { field: 'Description', title: '描述', width: 250, align: 'center' }
            ]],
            onLoadSuccess: function (data) {
                $(".loan_remove_button").linkbutton({ iconCls: 'icon-remove' });
                $(".loan_edit_button").linkbutton({ iconCls: 'icon-edit' });
            }
        });
    });

    function showEdit(id) {
        var width = 400;
        var height = 250;

        var title = '新增角色';
        var editActionUrl = '@Url.Action("Create")';

        if (id != null ) {
            editActionUrl = '@Url.Action("Edit")' + '?id=' + id;
            title = '编辑角色';
        }

        showWindow(title, editActionUrl, width, height);
    }

    function removeRole(id, name) {
        $.messager.confirm('Confirm', '确定删除角色\'' + name + '\'?'
            , function (r) {
                if (r) {
                    $.post('@Url.Action("Remove")', { id: id }, function (result) {
                        if (result.success) {
                            $('#tabRole').datagrid('reload');    // 重新加载用户数据
                        } else {
                            $.messager.alert({    // 显示错误信息
                                title: 'Error',
                                msg: result.errorMsg
                            });
                        }
                    }, 'json');
                }
            });
    }
</script>