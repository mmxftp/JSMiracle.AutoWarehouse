@{
    ViewBag.Title = "Index";
    
}

<div style="height:750px;">
    <div id='orderListToolbar'>
        <b><label style="padding-left:10px">查询明细</label></b>&nbsp;&nbsp;&nbsp;
        <input type="text" id="txt" class="easyui-textbox" style="width:200px;" />
        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search"
           onclick="window['orderformOp' + '@ViewBag.BizType'].reloadDataGrid()">查询</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add"
           onclick="window['orderformOp'+ '@ViewBag.BizType'].edit(false);">新增</a>
    </div>
    <div>
        <table id="orderFormGrid" style="padding:10px"></table>
    </div>
</div>

<script type="text/javascript">

    // 动态生成变量名，因为此页面被多个对象使用
    window['orderformOp' + '@ViewBag.BizType'];

    $(function () {

        $("#orderListToolbar").attr('id', 'orderListToolbar' + '@ViewBag.BizType');
        $("#orderFormGrid").attr('id', 'orderFormGrid' + '@ViewBag.BizType')

        // 必须在页面加载后执行，否则边框画不全，应该是easyui加载时边框距离计算错误的原因
        $("#orderFormGrid" + '@ViewBag.BizType').datagrid(
              {
                  url: '@Url.Action("GetOrderList", new { bizType = ViewBag.BizType })',
                  singleSelect: true,
                  loadMsg: '数据载入中...',
                  pagination: true, // 是否显示分页控件
                  pagesize: 10,      // 每页行数
                  pageList: [10],    // 要选的每页行数 为了界面显示正确一定要和pagesize的值相同
                  height: '750px',
                  toolbar: '#orderListToolbar' + '@ViewBag.BizType',
                  rownumbers: true,
                  frozenColumns: [[
                      {
                          field: '_operate', title: '操作', width: 150, align: 'center'
                          , formatter: function (value, row, index) {
                              var editFunStr = 'orderformOp' + '@ViewBag.BizType' + '.edit(true, ' + row.ID + ');';
                              var removeFunStr = 'JsMiracleCommon.removeItem(\'' + row.ID + '\',\''
                                  + row.DJBH + '\',\'@Url.Action("RemoveOrderForm")\',orderformOp' + '@ViewBag.BizType' + '.reloadDataGrid)';

                              var html = '<a href="javascript:void(0)"  class="loan_remove_button" '
                                        + ' onclick="' + removeFunStr + '" >删除</a>'
                                        + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
                                        + '<a href="javascript:void(0)"  class="loan_edit_button" '
                                        + ' onclick="' + editFunStr + '">修改</a>';
                              return html;
                          }
                      }
                  ]],
                  columns: [[

                      { field: 'DJBH', title: '单据编号', width: 100, align: 'center' },
                      { field: 'YWLX', title: '业务类型', width: 100, align: 'center' },
                      { field: 'SWSJBH', title: '上位单据编号', width: 150, align: 'center' },
                      { field: 'SWDJLX', title: '上位单据类型', width: 150, align: 'center' },
                      { field: 'DJZT', title: '单据状态', width: 150, align: 'center' },
                      { field: 'SFGX', title: '是否更新', width: 150, align: 'center' },
                      { field: 'DJLY', title: '单据来源', width: 150, align: 'center' },
                      { field: 'CJR', title: '创建人', width: 150, align: 'center' },
                      {
                          field: 'CJSJ', title: '创建时间', width: 150, align: 'center'
                          // dateTimeFormatter 在 ~/Scripts/CustomScripts/common.js 中定义好的方法，用于格式化数据字符串
                          , formatter: JsMiracleCommon.dateTimeFormatter
                      },
                      { field: 'WCR', title: '完成人', width: 150, align: 'center' },
                      {
                          field: 'WCJS', title: '完成时间', width: 150, align: 'center'
                          // dateTimeFormatter 在 ~/Scripts/CustomScripts/common.js 中定义好的方法，用于格式化数据字符串
                          , formatter: JsMiracleCommon.dateTimeFormatter
                      },
                      { field: 'GLDJ', title: '关联单据', width: 150, align: 'center' },
                      { field: 'BZ', title: '备注', width: 150, align: 'center' },
                      { field: 'MS', title: '描述', width: 150, align: 'center' },

                  ]],
                  onLoadSuccess: function (data) {
                      $(".loan_remove_button").linkbutton({ iconCls: 'icon-remove' });
                      $(".loan_edit_button").linkbutton({ iconCls: 'icon-edit' });
                  },
                  onLoadError: function (XMLHttpRequest) {
                      JsMiracleCommon.showWindowContent("error", XMLHttpRequest.responseText
                          , "500px", "500px");
                  }
              });

        // 每个页面的所有函数都定义成一个集合,访止方法名重覆
        window['orderformOp' + '@ViewBag.BizType'] = {
            edit: function (op, id) {
                var url = '@Url.Action("CreateOrderForm", new { bizType = ViewBag.BizType })';

                if (op) {
                    title = '订单信息编辑';
                    url = '@Url.Action("EditOrderForm")' + '?id=' + id;
                }

                // 调用 'refresh' 方法更新选项卡面板的内容
                var tab = $('#mainTabs').tabs('getSelected');  // 获取选择的面板
                tab.panel('refresh', url);
            },

            // 子页面回调函数
            reloadDataGrid: function () {
                var txtVal = $("#txt").val();

                $("#orderFormGrid" + '@ViewBag.BizType').datagrid('reload', {
                    txt: txtVal,
                });
            }
        };

    });


</script>